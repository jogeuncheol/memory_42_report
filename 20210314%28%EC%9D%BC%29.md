# 학습 레포트 50일차 2021-03-14 (일)

## 1. 학습 날짜
> ### 2021-03-14 (일)

## 2. 학습 시간
> ### 16:00 ~ 19:00 (집)
> ### 21:00 ~ 22:30 (집)

## 3. 학습 범위 및 주제
### | cub3D 방향 ray |

## 4. 동료 학습 방법
- 해당 없음


## 5. 학습 목표
- cub3D의 방향 ray 그리기위해 공부


## 6. 상세 학습 내용
- **실제 코딩 시간** 1시간
- **참고한 내용** [삼각함수](https://blockdmask.tistory.com/446), [math.h 위키](https://ko.wikipedia.org/wiki/C_%EC%88%98%EC%8B%9D_%ED%95%A8%EC%88%98)

### 방향 ray
cub3D 공부를 계속 하면서 먼저 바라보는 방향에 대한 ray을 표시해 보고 싶었다. 그래서 생각 해 보니 기준 점(플레이어)가 바라보는 기준 방향(동, 서, 남, 북)을 하나 정한 뒤, 그곳으로 최초에 ray를 그리도록 한다. 그리고 a, d 또는 q, e 나 방향키 좌, 우를 눌러 이 방향 좌표값을 이동 시켜 주면서 ray를 그려주면 플레이어가 바라보는 방향을 정해 줄 수 있을 것이라 생각했다.

오늘은 강의를 보고 자료들을 찾아보고 회전방법을 찾다보니 코드를 작성하진 못했지만 생각하고 수식을 정리해 보면
```
1. 최초 기준 플레이어 점을 (5, 5) 라고 정한다.
2. 최초 기준 방향 좌표를 (6, 5)(동쪽) 라고 정한다.
3. 그렇다면 최초의 플레이어가 향하는 방향은 동쪽이다.
```
먼저 최초의 플레이어를 생성하면서 바라보는 방향을 정해 준다.

```
1. 방향 좌표는 플레이어의 좌표 + (1, 0) 이 된다.
2. 만약 최초의 방향 좌표가 북쪽 이라면 플레이어 좌표 + (0, -1) 이 될 것이다.
```
방향 좌표 설정에 대한 기본 좌표설정을 위해 생각해 보았다.

```
1. 그렇다면 방향을 회전했을 때, 회전 좌표 값을 가져올 방법은?
2. 삼각함수를 사용해서 좌표값을 얻어 낼 수 있었다.
3. 플레이어 좌표(x, y) + 기준 방향(1, 0) + 회전 좌표(tan(a) * cos(a), tan(a) * sin(a))
```
플레이어의 좌표에 기준 방향 좌표를 더하면 초기 방향 ray를 그릴 준비가 된다. 플레이어 회전 했다는 것은 방향 좌표가 회전을 해 ray를 새로 그리게 된다. 회전하는 좌표 값은 삼각함수를 사용해 알아낼 수 있는데, tan(a) * cos(a) 를 하면 x 좌표 값을, tan(a) * sin(a)를 하면 y좌표 값을 알아 낼 수 있다.

tan(a) 는 삼각형의 높이 / 밑변 이고 cos(a) 는 삼각형의 밑변 / 빗변 이다. 만약 각 a 가 45 도 라면 tan(45) = 1, cos(45) = 루트2 / 2 이다. 각 a가 다른 특수각이 아니더라도 해당 식은 유효하고, 좌표평면의 4분면에 대해 +, - 가 적용 되므로 계산하기 쉽다. 기준 좌표에서 90도 270도를 이루는 경우만 따로 생각을 해줄 필요가 있다. 왜냐하면 tan(90)는 무한대로 값을 정확히 알아 낼 수 없기 때문이다.

```
위 삼각함수로 좌표 값을 얻을 때 기본적으로 플레이어 좌표를 기준으로 반지름이 1인 원을 생각하고 게산을 한다.
```
반지름이 1인 원을 생각하면 방향 좌표를 회전하고 계산할때 보다 쉽기 때문이다. 초기 기준 방향 좌표가 (1, 0) 이 었다면, 반시계 반향으로 회전하면, 각도가 90도 회전하기 까지 x, y 값이 줄어들며, 90도 부터 180도 까지는 x값은 줄어들고 y값은 다시 증가한다. 180도 부터 270도 까지는 x 값과 y 값이 증가하며, 270도 부터 360도 (원점) 까지는 x값은 증가하고 y값은 감소하여 기준 점으로 돌아온다.

x, y 값은 증가하고 감소하기를 반복하지만 1을 넘지 않으며, -1을 넘지 않는 범위에서 증가와 감소를 반복 할 것이다. 만약 시계방향으로 회전한다면 반대로 증가와 감소를 반복한다.

플레이어의 위치에서 가상의 반지름이 1인 원이 존재하고 원을 따라 좌표가 회전하며 그 좌표방향을 따라 플레이어가 전진 할 수 있도록 만들면 된다.

## 7. 학습 내용에 대한 개인적인 총평
플레이어가 바라보는 방향에 대한 값을 알고 있어야 나중에 수직으로 벽을 그릴 수 있을 것이다. 일단 2d raycasting을 구현하는 것을 1차 목표로 코드를 작성하려 하는데 생각보다 잘 되지 않는다. 코드를 작성하고 mlx 를 활용해서 그리는 것이 익숙하지 않아 더 힘들게 느껴진다. 그래도 방향에 대해 ray를 그리는 방법을 삼각함수를 이용해 그려볼 수 있을 것 같아 유튜브에 많은 강의를 참고해서 구현해 볼 수 있을 것같다. 코드를 작성하는게 쉽지는 않겠지만 현재 좌표와 회전 좌표를 DDA 함수로 넘겨주면 어떻게든 그려볼 수 있을 것 같다.

## 8.다음 학습 계획
- cub3D 공부