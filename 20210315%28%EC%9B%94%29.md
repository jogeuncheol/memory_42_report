# 학습 레포트 51일차 2021-03-15 (월)

## 1. 학습 날짜
> ### 2021-03-15 (월)


## 2. 학습 시간
> ### 18:00 ~ 23:00 (집)


## 3. 학습 범위 및 주제
### | cub3D 방향 ray 그리기 |

## 4. 동료 학습 방법
- 해당 없음


## 5. 학습 목표
- cub3D의 방향 ray 그리기 코드 작성


## 6. 상세 학습 내용
- **실제 코딩 시간** 3시간
- **참고한 내용** 

### 방향 ray

주말에 방향 ray를 그리기 위해 수식을 정리 해 봤었는데 잘못 계산을 했던것 같아 다시 계산을 해 보았다.
```
플레이어의 좌표(x, y) + 기준 방향(1, 0) * (cos(a), sin(a))
```
위 처럼 기준 방향으로 부터 각도 만큼 회전하면 cos 과 sin 함수를 사용해 좌표의 값을 얻을 수 있었다.\
방향 ray를 그릴 때 보기 쉽도록 50 픽셀 길이 만큼 그리기위해 50 * (cos, sin)을 해주었다. 회전한 각도에 대해 좌표값은 반지름 * cos(a), 반지름 * sin(a) 와 같다. 즉 위의 기준 방향이 반지름과 같이 작동을 할 것이라 생각한다.

### 각도
각도를 표현할 때, degree 360도 표현과 radian pi (3.141592...)로 표현을 할 수 있는데 cos, sin 함수를 사용하기 위해 각도를 radian으로 변환해줄 필요가 있었다.
```c
float seta
int i

seta = i * M_PI / 180;

```
seta는 radian으로 변환될 변수이다.\
i는 일반적으로 사용되는 각도 이다.\
M_PI는 math.h에 정의 되어있는 pi 값이다.\
각도 * M_PI / 180 수식을 사용해 라디안 값으로 변환해 줄 수 있다.

### 기준 방향
기준 방향을 동, 서, 남, 북 네 방향으로 설정 할 수 있다. 나는 테스트할 떄 생각하기 쉽도록 동쪽을 기준으로 잡았다.
```c
param->xy.x2 = 50 * cos(0);
param->xy.y2 = 50 * sin(0);
```
cos(0) 은 1 이고, sin(0)은 0이다 즉 기준 방향을 (1, 0) 좌표로 잡았고 50을 곱해준 이유는 방향 ray를 그려서 확인하기 쉽도록 하기 위해 50 배를 해 주었다.

### 방향 ray 그리기

기준 방향 설정도 해주었고, 이제 그리기만 하면 된다. DDA 알고리즘을 사용해서 직선을 그릴 것이다.
```c
float dx, dy;
float step;
float xinc, yinc;
int i;

i = 0;
param->xy.x1 = param->x;
param->xy.y1 = param->y;
dx = (param->x + param->xy.x2) - param->x;
dy = (param->y + param->xy.y2) - param->y;
if (sqrt(dx * dx) > sqrt(dy * dy))
    step = sqrt(dx * dy);
else
    step = sqrt(dy * dy);
xinc = dx / step;
yinc = dy / step;
while (i < step)
{
    mlx_pixel_put(param->mlx_ptr, param->win_ptr, param->xy.x1, param->xy.y1, 0xffff);
    param->xy.x1 = param->xy.x1 + xinc;
    param->xy.y1 = param->xy.y1 + yinc;
    i++;
}
```
DDA 알고리즘은 동일하게 사용하였고, param->xy.x1은 현재 플레이어 좌표부터 바라보는 방향 ray의 좌표까지 x증가값과 y증가값에 따라 증가하며 픽셀을 표시한다.

코드를 실행하고 움직여 보면 현재 좌표에서 동쪽으로 50픽셀만큼 직선이 그어져 따라다니는 것을 볼 수 있었다.

## 7. 학습 내용에 대한 개인적인 총평
플레이어가 바라보는 각도를 설정하기 위해 수식을 정리하는데 계산 실수가 있었어서 회전 방향을 그리는 코드를 작성 할 때 힘이 들었다. 특히 x, y 좌표 값들을 처음에는 전부 int 타입을 사용 했었는데 이것때문에 각도에 해당하는 좌표값이 제대로 표현되지 않아 오래 걸렸었다. 그래도 전 후 좌 우 회전 과 방향 ray 그리기 까지 코드를 작성하고 레포트를 작성하면서 한번 더 코드를 리뷰하는 것으로 지금 까지 코드를 정리해 보려고 한다.

## 8. 다음 학습 계획
- cub3D 공부