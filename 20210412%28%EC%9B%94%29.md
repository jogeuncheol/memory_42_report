# 학습 레포트 65일차 2021-04-12 (월)

## 1. 학습 날짜
> ### 2021-04-12 (월)

## 2. 학습 시간
> ### 15:00 ~ 18:00 (집)
> ### 20:00 ~ 23:00 (집)

## 3. 학습 범위 및 주제
### | 어안 현상 해결하기 |

## 4. 동료 학습 방법
- 해당 없음

## 5. 학습 목표
- cub3D 벽의 어안현상 해결하기

## 6. 상세 학습 내용
- **실제 코딩 시간** 5시간
- **참고한 내용** [odev_raycasting](https://lodev.org/cgtutor/raycasting.html)

### 어안 현상
어안 렌즈는 카메라 등에서 사용하는 사진 렌즈로, 중심 투영 방식이 아닌 투영방식을 채용하고 있는 것을 가리킨다. 어안이라는 명칭의 유래는 어류의 관점인 물밑에서 수면 위를 올려보는 경우 물의 굴절률의 관계로 따질 때 수상의 풍경이 원형으로 보이는 것에서 왔다.[어안렌즈 위키백과](https://ko.wikipedia.org/wiki/%EC%96%B4%EC%95%88_%EB%A0%8C%EC%A6%88)

cub3D 에서 플레이어와 벽 사이의 거리에 따라 어안 현상이 일어나는 이유로 거리에 따라 보정없이 벽을 그려 주변부의 왜곡이 발생하는 것이다. 플레이어가 벽을 평행하게 마주보고 있다면 플레이어에 수직인 광선의 길이는 플레이어의 시야각안의 어떤 광선보다 그 길이가 짧다. 시야각의 양 끝 길이는 가장 길게 된다. 길이에 따라 벽의 높낮이를 다르게 하여 원근감을 주었는데 이것이 문제가 되는 것이다.\
플레이어로부터 멀리있는 벽은 더 낮게, 플레이어와 가까이 있는 벽은 더 높게 그리려고 했기 때문이다.

### 어안 해결방법
주변 왜곡 현상을 해결하기위해서는 벽과의 길이를 다른 방법으로 재야했다. 나는 두가지 방법으로 시도를 해 보았는데 하나는 단순히 플레이어와 벽 사이의 거리에 cos으로 p_w 사이의 거리를 빗변으로 둔 삼각형의 밑변의 길이를 계산하는 것이었고, 다른 하나는 플레이어와 벽 사이에 두 삼각형을 설정해 플레이어로부터 벽사이의 x, y 거리에 따라 cos, sin 값을 더해 길이를 계산하는 방법을 적용 해 보았다.

### 1. 빗변에 대한 밑변 계산 cos
```c
void screen_pixel_put(t_param *param, int width_inc, float fov)
{
    ...
    dst = sqrt(pow(dst_x, 2) + pow(dst_y, 2));
    dst_1 = dst * cos(((int)fov - param->degree) * M_PI / 180);
    ...
}
```

dst는 플레이어와 벽 사이의 거리로 `√dst_x^2 + dst_y^2` 이다.\
dst_1은 광선이 벽에 닿았을 때의 좌표에서 플레이어가 바라보는 벡터에 수선의 발을 내린 직각 삼각형의 cos 으로 길이를 보정한 계산이다.\
fov각도 - degree로 플레이어가 바라보는 벡터에서 각도를 설정 한 뒤, cos으로 그 밑변의 길이를 구해 주었다.

### 2. 플레이어 좌표와 벽 좌표의 x, y 값에 대한 두 삼각형으로 계산한 거리 cos + sin

```c
void screen_pixel_put(t_param *param, int width_inc, float fov)
{
    ...
    dst = sqrt(pow(dst_x, 2) + pow(dst_y, 2));
    dst_2 = dst_x * cos(param->seta) + dst_y * sin(param->seta);
    ...
}
```




## 7. 학습 내용에 대한 개인적인 총평

## 8. 다음 학습 계획
