# 학습 레포트 53일차 2021-03-17 (수)

## 1. 학습 날짜
> ### 2021-03-17 (수)

## 2. 학습 시간
> ### 22:00 ~ 24:00 (집)

## 3. 학습 범위 및 주제
### | cub3D 방향ray로 직진 |

## 4. 동료 학습 방법
- 해당 없음

## 5. 학습 목표
- cub3D의 직진과 후진 코드 작성

## 6. 상세 학습 내용
- **실제 코딩 시간** 1시간
- **참고한 내용** 없음

### 직진 방향 설정하기
지금까지 픽섹을 움직일 때, w, a, s, d를 눌러 전후 좌우로 움직여 주었다. 위로 움직일 때는 y 값을 줄이고 아래로 움직일 때는 y값을 늘리는 방식으로 위 아래 좌 우 로 움직여 주었는데 실제 움직임은 그렇지 않아야 한다.

실제 움직임은 바라보는 방향을 향해 전진 하며 바라보는 방향의 반대로 후진을 하게 된다. 좌 우 움직임도 마찬가지로 바라보는 방향의 수직으로 좌 우 로 움직인다. 따라서 지금 작성해둔 코드를 수정 해 줄 필요가 있었다.

### 직진은 방향 ray를 향해 나아간다.
직진과 후진 좌표를 설정하는 것은 생각보다 어렵지 않았다. 현재 좌표에서 바라보는 방향의 방향 좌표 값을 더해주면 되기 때문이다.
```c
param->x = param->x + param->xy.x2;
param->y = param->y + param->xy.y2;
```
방향 ray 회전에서 param->xy.x2, param->xy.y2 는 회전한 방향 좌표값을 나타낸다. 따라서 현재 좌표 (x, y) 에 (xy.x2, xy.y2) 값을 더해주면 플레이어 좌표는 직진한 처럼 볼 수 있다.

### 움직일 거리
그렇지만 xy.x2, xy.y2 값을 그냥 더해주게 되면 방향 ray의 끝점으로 이동을 하게 된다. 왜냐하면 방향 좌표 값은 직선을 표시하기위해 기준좌표에 가상의 반지름 50을 곱해준 좌표 값이기 때문이다. 따라서 플레이어가 이동할 좌표값은 정확하게는 기준좌표를 사용해 움직여 주어야 한다.

### 기준 좌표와 방향 좌표
내가 작성하고 있는 코드에서 지금까지 플레이어의 좌표로 세 가지 좌표를 사용했다.
```
1. 플레이어 좌표
2. 기준 좌표
3. 방향 좌표
```
1. 플레이어 좌표는 현재 위치를 표시하는 좌표이다.
2. 기준 좌표는 플레이어가 처음 생성 될 때 바라보고 있는 좌표로 동, 서, 남, 북 네 방향 값을 가질 수 있고 기준 좌표로 회전과 전후 좌우 움직임이 구현된다.
3. 방향 좌표는 단순히 플레이어가 바라보는 방향을 표시 하기 위해 기준 좌표에 가상의 원의 반지름을 곱해 직선을 그리기 위한 좌표 값이다.

움직임을 구현할 때 방향 좌표는 플레이어의 시선 방향을 나타 낼 뿐 그대로 좌표 값을 사용하게되면 움직임이 너무 커지게 된다. 그렇지만 방향좌표는 기준좌표로부터 반지름을 곱한 값이므로 1픽셀 움직임이 필요하면 곱해준 반지름을 다시 나누어 사용하면 된다.

### 전진, 후진
```c
int key_press(int keycode, t_param *param)
{
...
    if (keycode == KEY_W)
    {
        param->x = param->x + (param->xy.x2 / 10);
        param->y = param->y + (param->xy.y2 / 10);
    }
    else if (keycode == KEY_S)
    {
        param->x = param->x - (param->xy.x2 / 10);
        param->y = param->y - (param->xy.y2 / 10);
    }
...
}
```
방향 좌표 값 xy.x2, xy.y2 값을 10으로 나누어준 이유는 위에서 설명했듯이 움직일 거리를 조절해 주기 위해서 이다. 현재 설정된 xy.x2, xy.y2 값은 방향 좌표 값으로 50 이 곱해져 있기 때문에 10으로 나누어 한번 움직일 때 5만큼 움직이도록 설정해 주었다. 1픽셀씩 움직이면 움직임이 너무 느려 테스트 하기 번거로워 움직이는 단위를 5씩 움직이도록 해주었다.

## 7. 학습 내용에 대한 개인적인 총평
이후에는 해당 값을 수정해서 사용할 계획이다. 현재는 방향좌표 값이 xy.x2, xy.y2 값으로 설정 되어 있기 때문에 기준 좌표로 사용 할 때는 반대로 나누어 주어야 하는데 내가 생각한 방향과 반대로 설정되어있다고 생각한다.

## 8. 다음 학습 계획
- cub3D 공부