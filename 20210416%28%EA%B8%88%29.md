# 학습 레포트 68일차 2021-04-16 (금)

## 1. 학습 날짜
> ### 2021-04-16 (금)

## 2. 학습 시간
> ### 18:00 ~ 24:00 (집)

## 3. 학습 범위 및 주제
### | 벽 추적 hit_x |

## 4. 동료 학습 방법
- 해당 없음

## 5. 학습 목표
- 벽 추적 방법 2 hit_x

## 6. 상세 학습 내용
- **실제 코딩 시간** 5시간
- **참고한 내용** 없음

### hit_x 찾기

hit_x를 찾기위해서는 hit_y를 추적하는 것고 방식은 동일하지만 몇가지 수정이 필요했다.

```c
if ((param->degree > 0 && param->degree < 180) || (param->degree < -180 && param->degree > -360))
{
    next_y = g_y + 1;
    hit_y = next_y * TILE_SIZE;
    if (fabs(cos(param->seta)) < 0.001)
        tan = 0;
    else
        tan = sin(M_PI_2 - param->seta) / cos(M_PI_2 - param->seta);
    hit_x = (hit_y - param->y) * tan + param->x;
}
else if ((param->degree < 0 && param->degree > -180) || (param->degree > 180 && param->degree < 360))
{
    next_y = g_y;
    hit_y = next_y * TILE_SIZE;
    if (fabs(cos(param->seta)) < 0.001)
        tan = 0;
    else
        tan = sin(M_PI_2 - param->seta) / cos(M_PI_2 - param->seta);
    hit_x = (hit_y - param->y) * tan + param->x;
}
else
{
    hit_x = param->x;
    hit_y = param->y;
}
```

if 조건에 각도에 대해 절댓값을 적용 할 수 없었다. 왜냐하면 범위가 sin 함수의 범위로 0도 ~ 180도와 -180도 ~ -360도를 같은 범위로 두어야 하고, 0도 ~ -180도 와 180도 ~ 360도를 같은 범위로 설정해야 하기 때문이었다.

동쪽 서쪽과 동일하게 북쪽 서쪽도 g_y, g_y + 1로 설정하였다. tan값을 구할 떄 M_PI_2 = 90도에서 플레이어의 방향 각도를 빼준 이유는 hit_x를 구하는 방법이 sin 함수를 사용하기 때문에 일반 각도를 90도를 기준으로 돌려서 cos 과 같게 계산하기 위해서이다.

```
if ((param->degree > 0 && param->degree < 180) || (param->degree < -180 && param->degree > -360))
```
플레이어가 남쪽을 바라볼 때 위 조건을 사용한다. 각도의 범위가 남쪽인데 0도 ~ 180도 인 이유는 윈도우의 좌표는 뒤집어진 좌표평면이기 떄문에 남쪽으로 갈수록 값이 커지기 때문이다. 같은 이유로 -180도 ~ -360도의 범위가 남쪽을 가리킨다.

```
else if ((param->degree < 0 && param->degree > -180) || (param->degree > 180 && param->degree < 360))
```
0도 ~ -180도가 북쪽을 가리키는 이유는 윈도우에서 위쪽일 수록 값이 작아지기 때문이다. 이유는 위의 조건과 같다.

### 수정한 점

처음에는 hit_y좌표를 찾는 코드, cos에 대한 좌표처럼 절댓값을 사용했다가 결과가 제대로 나오지 않았다. 조건을 각각의 구간으로 다시 나누고 정리하면서 sin 함수에서는 절댓값을 적용할 수 없다는 것을 꺠달았다. 또한 else 조건도 필요한 것을 알아내었다. hit_y, hit_x를 각각 만 적용하면 문제는 없이 작동을 했는데, 두 함수를 같이 적용하면 ray가 제대로 그려지지 않아 else 조건으로 0도 90도 270도에서 따로 적용을 해주었다.

## 7. 학습 내용에 대한 개인적인 총평
벽을 찾는 방법을 이전부터 고민했는데 이번에 잘 찾아낸 것 같아 기분이 좋다. 격자 구간으로 찾는 것을 거의 cub3D 공부를 시작하고 계속 고민했었는데, 드디어 실마리가 보이는 것 같다. 다음에는 각 격자의 다음 좌표 구간을 계산 해 적용하면 될 것같다. 이 방법을 사용하는것이 속도도 빠르고 일반적인 방법이라고 생각한다.

## 8. 다음 학습 계획
- cub3D 공부 - 연속 격자 추적